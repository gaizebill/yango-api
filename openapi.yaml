openapi: 3.0.3
info:
  title: Yango Bolivia API
  version: 1.0.0
  description: |
    API de integración B2B Yango Bolivia, basada en la colección Postman "BOLIVIA YANGO API".

servers:
  - url: https://b2b.taxi.yandex.net
    description: Servidor principal B2B Yango

security:
  - bearerAuth: []

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    TariffsRequest:
      type: object
      properties:
        start_point:
          type: array
          description: Coordenadas [longitud, latitud] del punto de inicio.
          items:
            type: number
          minItems: 2
          maxItems: 2
      required:
        - start_point

    CheckPriceRequest:
      type: object
      properties:
        client_requirements:
          type: object
          properties:
            cargo_options:
              type: array
              items:
                type: string
            taxi_class:
              type: string
              description: '"courier" para Express/SDD, "cargo" para Cargo.'
        route_points:
          type: array
          items:
            type: object
            properties:
              coordinates:
                type: array
                items:
                  type: number
                minItems: 2
                maxItems: 2
      required:
        - client_requirements
        - route_points

    ClaimCreateRequest:
      type: object
      description: Cuerpo genérico para creación de reclamaciones (prepaid o payment on arrival).
      properties:
        due:
          type: string
          format: date-time
          description: Fecha/hora programada del pedido.
        callback_properties:
          type: object
          properties:
            callback_url:
              type: string
              format: uri
        client_requirements:
          type: object
          properties:
            taxi_class:
              type: string
            pro_courier:
              type: boolean
        comment:
          type: string
        emergency_contact:
          type: object
          properties:
            name:
              type: string
            phone:
              type: string
        items:
          type: array
          items:
            type: object
            properties:
              cost_currency:
                type: string
              cost_value:
                type: string
              droppof_point:
                type: integer
              extra_id:
                type: string
              pickup_point:
                type: integer
              quantity:
                type: integer
              size:
                type: object
                properties:
                  height:
                    type: number
                  length:
                    type: number
                  width:
                    type: number
              title:
                type: string
              weight:
                type: number
              fiscalization:
                type: object
                properties:
                  article:
                    type: string
                  excise:
                    type: string
                  vat_code_str:
                    type: string
        optional_return:
          type: boolean
        referral_source:
          type: string
        route_points:
          type: array
          items:
            type: object
            properties:
              address:
                type: object
                properties:
                  fullname:
                    type: string
                  coordinates:
                    type: array
                    items:
                      type: number
                    minItems: 2
                    maxItems: 2
                  city:
                    type: string
                  comment:
                    type: string
                  country:
                    type: string
              contact:
                type: object
                properties:
                  email:
                    type: string
                  name:
                    type: string
                  phone:
                    type: string
              external_order_id:
                type: string
              point_id:
                type: integer
              skip_confirmation:
                type: boolean
              type:
                type: string
                description: source / destination
              visit_order:
                type: integer
              buyout:
                type: object
                properties:
                  payment_method:
                    type: string
              payment_on_delivery:
                type: object
                properties:
                  customer:
                    type: object
                    properties:
                      email:
                        type: string
                      phone:
                        type: string
                  payment_method:
                    type: string
        skip_act:
          type: boolean
        skip_client_notify:
          type: boolean
        skip_door_to_door:
          type: boolean
        skip_emergency_notify:
          type: boolean
        auto_accept:
          type: boolean

    ClaimVersionBody:
      type: object
      properties:
        version:
          type: integer
      required:
        - version

    CancelClaimBody:
      type: object
      properties:
        cancel_state:
          type: string
          description: free, paid o unavailable, obtenido de cancel-info.
        version:
          type: integer
      required:
        - cancel_state
        - version

paths:
  /b2b/cargo/integration/v2/tariffs:
    post:
      summary: Get classes available at the point
      tags: [Express Service]
      security:
        - bearerAuth: []
      parameters:
        - in: header
          name: Accept-Language
          schema:
            type: string
            enum: [es, en, ru]
          required: false
          description: Idioma de la respuesta.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TariffsRequest'
            example:
              start_point: [-63.19693640595825, -17.757501746861674]
      responses:
        '200':
          description: Lista de clases/servicios disponibles en el punto.
        '400':
          description: Petición inválida.
        '401':
          description: No autorizado.

  /b2b/cargo/integration/v2/check-price:
    post:
      summary: Initial cost estimate without creating a claim
      tags: [Express Service]
      security:
        - bearerAuth: []
      parameters:
        - in: header
          name: Accept-Language
          schema:
            type: string
            enum: [es, en, ru]
          required: false
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CheckPriceRequest'
            example:
              client_requirements:
                cargo_options: ["thermobag"]
                taxi_class: "courier"
              route_points:
                - coordinates: [-63.19693640595825, -17.757501746861674]
                - coordinates: [-63.19693640595825, -17.757501746861674]
      responses:
        '200':
          description: Estimación de costo devuelta correctamente.
        '400':
          description: Petición inválida.
        '401':
          description: No autorizado.

  /b2b/cargo/integration/v2/claims/create:
    post:
      summary: Create claim (prepaid or payment on arrival)
      tags: [Claims]
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: request_id
          schema:
            type: string
          required: true
          description: Clave de idempotencia, distinta en cada llamada.
        - in: header
          name: Accept-Language
          schema:
            type: string
            enum: [es, en, fr]
          required: false
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ClaimCreateRequest'
            examples:
              prepaid:
                summary: Ejemplo de pedido prepagado
                value:
                  due: "2025-01-27T22:00:00+00:00"
                  callback_properties:
                    callback_url: "https://webhook.site/your-callback"
                  client_requirements:
                    taxi_class: "courier"
                  comment: "Comentario"
                  emergency_contact:
                    name: "Contacto de Emergencia"
                    phone: "+56900000000"
                  items:
                    - cost_currency: "BOB"
                      cost_value: "100"
                      droppof_point: 2
                      extra_id: "TEST-ORDER-1"
                      pickup_point: 1
                      quantity: 1
                      size:
                        height: 0.1
                        length: 0.1
                        width: 0.1
                      title: "Artículo de prueba"
                      weight: 2
                  optional_return: false
                  referral_source: "NOMBRE_DE_TU_EMPRESA"
                  route_points:
                    - address:
                        fullname: "Cuarto Anillo, Radial 21 y, Santa Cruz de la Sierra, Bolivia"
                        coordinates: [-63.21628097602036, -17.77781901325718]
                        city: "Santa Cruz de la Sierra"
                        comment: "Comentario para el repartidor"
                        country: "Bolivia"
                      contact:
                        email: "example+a@yango.com"
                        name: "Punto A"
                        phone: "+56900000000"
                      external_order_id: "TEST-ORDER-1"
                      point_id: 1
                      skip_confirmation: true
                      type: "source"
                      visit_order: 1
                    - address:
                        fullname: "Av. Argentina 280, Santa Cruz de la Sierra, Bolivia"
                        coordinates: [-63.17492724068364, -17.797046545189804]
                        city: "Santa Cruz de la Sierra"
                        comment: "Comentario para el repartidor en Punto B"
                        country: "Bolivia"
                      contact:
                        email: "example+b@yango.com"
                        name: "Punto B"
                        phone: "+56900000000"
                      external_order_id: "TEST-ORDER-1"
                      point_id: 2
                      skip_confirmation: true
                      type: "destination"
                      visit_order: 2
                  skip_act: false
                  skip_client_notify: false
                  skip_door_to_door: false
                  skip_emergency_notify: false
              payment_on_arrival:
                summary: Ejemplo de pago a la entrega
                value:
                  callback_properties:
                    callback_url: "https://mi-sitio.com/callback"
                  client_requirements:
                    pro_courier: false
                    taxi_class: "courier"
                  comment: "Comentario"
                  emergency_contact:
                    name: "Contacto de Emergencia"
                    phone: "+56900000000"
                  items:
                    - cost_currency: "BOB"
                      cost_value: "100"
                      droppof_point: 2
                      extra_id: "TEST-ORDER-1"
                      pickup_point: 1
                      quantity: 1
                      size:
                        height: 0.1
                        length: 0.1
                        width: 0.1
                      title: "Artículo de prueba"
                      fiscalization:
                        article: "PRODUCT-SKU"
                        excise: "1000"
                        vat_code_str: "vat10"
                      weight: 2
                  optional_return: false
                  referral_source: "API_TU-EMPRESA"
                  route_points:
                    - address:
                        fullname: "Cuarto Anillo, Radial 21 y, Santa Cruz de la Sierra, Bolivia"
                        coordinates: [-63.21699789668903, -17.783850820078335]
                        city: "Santa Cruz de la Sierra"
                        comment: "Comentario para el repartidor"
                        country: "Bolivia"
                      contact:
                        email: "example+a@yango.com"
                        name: "Punto A"
                        phone: "+56900000000"
                      external_order_id: "TEST-ORDER-1"
                      point_id: 1
                      skip_confirmation: true
                      type: "source"
                      visit_order: 1
                    - address:
                        fullname: "Cuarto Anillo, Radial 21 y, Santa Cruz de la Sierra, Bolivia"
                        coordinates: [-63.21699789668903, -17.783850820078335]
                        city: "Santa Cruz de la Sierra"
                        comment: "Comentario para el repartidor"
                        country: "Bolivia"
                      contact:
                        email: "example+b@yango.com"
                        name: "Punto B"
                        phone: "+56900000000"
                      external_order_id: "TEST-ORDER-1"
                      buyout:
                        payment_method: "cash"
                      payment_on_delivery:
                        customer:
                          email: "example+cliente@yango.com"
                          phone: "+56900000000"
                        payment_method: "cash"
                      point_id: 2
                      skip_confirmation: true
                      type: "destination"
                      visit_order: 2
                  skip_act: false
                  skip_client_notify: false
                  skip_door_to_door: false
                  skip_emergency_notify: false
                  auto_accept: true
      responses:
        '200':
          description: Claim creada correctamente.
        '400':
          description: Error en los datos de entrada.
        '401':
          description: No autorizado.

  /b2b/cargo/integration/v2/claims/info:
    post:
      summary: Get claim information (Claim status)
      tags: [Claims]
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: claim_id
          required: true
          schema:
            type: string
          description: Claim Id devuelto por la creación de la claim.
        - in: header
          name: Accept-Language
          schema:
            type: string
            enum: [es, en, ru]
          required: false
        - in: header
          name: Content-Type
          schema:
            type: string
          required: false
      responses:
        '200':
          description: Información actual de la claim.
        '400':
          description: Petición inválida.
        '401':
          description: No autorizado.

  /b2b/cargo/integration/v2/claims/accept:
    post:
      summary: Confirm claim
      tags: [Claims]
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: claim_id
          required: true
          schema:
            type: string
          description: Claim Id a confirmar.
        - in: header
          name: Accept-Language
          schema:
            type: string
            enum: [es, en, ru]
          required: false
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ClaimVersionBody'
            example:
              version: 1
      responses:
        '200':
          description: Claim confirmada correctamente.
        '400':
          description: Error en la versión u otros datos.
        '401':
          description: No autorizado.

  /b2b/cargo/integration/v2/claims/cancel-info:
    post:
      summary: Get cancellation identifier
      tags: [Claims]
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: claim_id
          required: true
          schema:
            type: string
          description: Claim Id a consultar.
        - in: header
          name: Accept-Language
          schema:
            type: string
            enum: [es, en, ru]
          required: false
        - in: header
          name: Content-Type
          schema:
            type: string
          required: false
      responses:
        '200':
          description: Información de cancelación (cancel_state, etc.).
        '400':
          description: Petición inválida.
        '401':
          description: No autorizado.

  /b2b/cargo/integration/v1/claims/cancel:
    post:
      summary: Cancel claim
      tags: [Claims]
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: claim_id
          required: true
          schema:
            type: string
          description: Claim Id a cancelar.
        - in: header
          name: Accept-Language
          schema:
            type: string
            enum: [es, en, ru]
          required: false
        - in: header
          name: Content-Type
          schema:
            type: string
          required: false
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CancelClaimBody'
            example:
              cancel_state: "free"
              version: 1
      responses:
        '200':
          description: Claim cancelada correctamente.
        '400':
          description: Error en la versión, cancel_state o estado de la claim.
        '401':
          description: No autorizado.
